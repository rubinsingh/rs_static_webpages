<html>
<head>
<title>Geo-targeting example</title>
</head>
<body>
<script type="text/javascript">
	var options = {
		enableHighAccuracy: true,
		timeout: 5000,
		maximumAge: 0
	};
	
    function initBranch(city) {
	branch.init('key_live_gimC2ehxzwjHcbyQzXQxfdmpvzcgkwsC', { metadata: { 'location':city } });
    }

    function success(pos) {
    	var crd = pos.coords;
	console.log('Your current position is:');
	console.log(`Latitude : ${crd.latitude}`);
	console.log(`Longitude: ${crd.longitude}`);
	console.log(`More or less ${crd.accuracy} meters.`);
	var geocoder = new google.maps.Geocoder;
	var latlng = {lat: parseFloat(crd.latitude), lng: parseFloat(crd.longitude)};
	geocoder.geocode({'location': latlng}, function(results, status) {
		if (status === 'OK') {
			if (results[2] && results[2].address_components) {
				var city = results[2].address_components[1].long_name.replace(' ', '');
				initBranch(city);
			} else {
				window.alert('No results found');
			}
		} else {
			window.alert('Geocoder failed due to: ' + status);
		}
  	});
    }
    function getCity() {
    
    }
    function error(err) {
        var message = err.code + " " + err.message;
    	alert(message);
    }
    function initMap() {
	    navigator.geolocation.getCurrentPosition(success, error, options);
    }
</script>
<script>
(function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent".split(" "), 0);
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxfb3xPzuPGxbec9c0haoYtg1CLV1KHVY&callback=initMap"
        async defer></script>
</body>
</html>
